# 10강 옵셔널
### 📝 김영한 실전 자바 고급편 3 - 강의 정리 노트

이전강의에서 간단히 나왓던 옵셔널에 대해 자세히 알아보자

```java
    // 이름이 있으면 이름을 대문자로 출력, 없으면 unknown 출력
    static void findAndPrint(long id) {
        String name = findNameById(id);
        // 1. nullPointerException 유발
        //System.out.println("name: " + name.toUpperCase());

        //2. if 문을 활용한 null 체크 활용
        if (name != null) {
            System.out.println(id + ": " + name.toUpperCase());
        } else {
            System.out.println(id + ": " + "UNKNOWN");
        }
    }
```
기존에는 NullPointerException를 방지하기 위해서 null 체크는 if문을 활용해야만 했다.

```java
    // 이름이 있으면 이름을 대문자로 출력, 없으면 unknown 출력
    static void findAndPrint(long id) {
        // 옵셔널 사용하면 값이 있을수도 없을수도 있다라는 것을 인지하고 구현할 수 있게 됨.
        Optional<String> optName = findNameById(id);
        String name = optName.orElse("UNKNOWN");
        System.out.println("name: " + name.toUpperCase());
    }
```
`Optional<String>`와 같이 옵셔널을 반환하도록 하면 값이 없을 수 있다는 의도가 전달된다.
코드를 보면 옵셔널의 orElse(대체값)을 통해 값이 없다면 대체값을 반환할 수 있어
놓치기 쉬운 null 체크를 강제하여 코드의 안정성을 높일수 있다.

---

## Optional의 생성

```java
        //1. of() : 값이 null 이 아님이 확실할 때 사용, null 이면 NullpointerException 발생
        String nonNullValue = "Hello Optional";
        Optional<String> op1 = Optional.of(nonNullValue);

        //2. ofNullable() : 값이 null일수도 아닐수도 있을때
        Optional<String> op2 = Optional.ofNullable("Hello!");
        Optional<String> op3 = Optional.ofNullable(null);

        // 3. empty()
        Optional<String> op4 = Optional.empty();
```
- Optional.of()는 내부값이 확실히 Null이 아닐 때 사용한다.
  - null 전달하면 `NullPointerException` 일어난다.
- Optional.ofNullable()는 값이 null일 수도 아닐수도 있을 때 사용한다.
  - null이면 Optional.empty() 반환
- Optional.empty()는 명시적으로 `값이 없음`을 표현한다.

---

## Optional의 값 획득
isPresent(), isEmpty() 값이 있으면 true, 없으면 false
get() 값이 있는 경우 값 반환, 값이 없으면 NoSuchElementException 발생하므로 주의
orElse() 값이 있으면 그 값을 반환, 값이 없으면 other를 반환
orElseGet() 값이 있으면 값 반환, 없으면 supplier 호출해 생성된 값 반환
orElseThrow() 값이 있으면 그 값 반환, 없으면 예외 던짐
or() 값이 있으면 해당 값의 Optional 반환 없으면 supplier가 제공하는 다른 Optional 반환

---

## Optional의 값 처리
옵셔널에서 값이 존재할 때와 존재하지 않을때 제공하는 메서드를 활용하면 null 체크 로직 어뵤이
안전하고 간결하게 값을 다룰 수 있다.

코드를 통해 알아보자
```java
System.out.println("=== 1. ifPresent() ===");
optValue.ifPresent(x -> System.out.println(x));
optEmpty.ifPresent(x -> System.out.println(x)); //실행 x
```
`ifPresent`는 값이 존재하면 action 실행, 없으면 아무것도 하지 않는다.

```java
System.out.println("=== 2. ifPresentOrElse() ===");
optValue.ifPresentOrElse(
        v -> System.out.println("optvalue 값 " + v),
        () -> System.out.println("값 비어있지롱"));
```
`ifPresentOrElse`는 값이 존재하면 action 실행하고 없으면 emptyAction을 실행한다.

```java
System.out.println("=== 3. map() ===");
Optional<Integer> lengthOpt1 = optValue.map(String::length);
        System.out.println("optValue.map(String::length) = " + lengthOpt1);
```
map은 값이 있으면 mapper를 적용해 결과를 반환하고
값이 없으면 Optional.empty()를 반환한다.
```java
System.out.println("=== 4. flatMap() ===");
Optional<String> flattenedOpt = optValue.flatMap(s -> Optional.of(s));
System.out.println("flattenedOpt = " + flattenedOpt);
```
flatMap은 map과 유사하지만 Optional을 반환할 때 중첩되지 않고 평탄화해서 반환한다.

```java
System.out.println("=== 5. filter() ===");
Optional<String> filtered1 = optValue.filter(s -> s.startsWith("H"));
Optional<String> filtered2 = optValue.filter(s -> s.startsWith("X"));

System.out.println("filter(H) = " + filtered1);
System.out.println("filter(X) = " + filtered2);
```
filter는 값이 있고 조건을 만족하면 그 결과를 반환한다. 

```java
System.out.println("=== 6. stream() ===");
        optValue.stream()
                .forEach(s -> System.out.println("optValue = " + s));

        // 값이 없어서 실행 x
        optEmpty.stream()
                .forEach(s -> System.out.println("optEmpty = " + s));
```
값이 있으면 단일 요소를 담은 Stream을 반환하고 없으면, 빈 스트림을 반환한다.

---

## 즉시 평가와 지연 평가
