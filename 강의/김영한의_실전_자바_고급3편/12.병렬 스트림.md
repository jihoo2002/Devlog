# 12ê°• ë³‘ë ¬ ìŠ¤íŠ¸ë¦¼
### ğŸ“ ê¹€ì˜í•œ ì‹¤ì „ ìë°” ê³ ê¸‰í¸ 3 - ê°•ì˜ ì •ë¦¬ ë…¸íŠ¸

í•˜ë‚˜ì˜ ë©”ì¸ ìŠ¤ë ˆë“œë¡œ ì‘ì—…í•˜ë©´ ì‹¤í–‰ ì‹œê°„ì´ ë„ˆë¬´ ì˜¤ë˜ ê±¸ë¦¬ê²Œ ëœë‹¤.<br>
ë”°ë¼ì„œ ì—¬ëŸ¬ ìŠ¤ë ˆë“œë¥¼ ë™ì‹œì— ì‚¬ìš©í•´ì„œ ì‘ì—…ì„ ë” ë¹¨ë¦¬ ì²˜ë¦¬í•´ë³´ë„ë¡ í•˜ì

## ìŠ¤ë ˆë“œ í’€ ì‚¬ìš©
```java
        ExecutorService es = Executors.newFixedThreadPool(2);
        long startTime = System.currentTimeMillis();

        // 1. ì‘ì—…ì„ ë¶„í• í•œë‹¤.
        SumTask task1 = new SumTask(1, 4);
        SumTask task2 = new SumTask(5, 8);

        // 2. ë¶„í• í•œ ì‘ì—…ì„ ì²˜ë¦¬í•œë‹¤.
        Future<Integer> future1 = es.submit(task1);
        Future<Integer> future2 = es.submit(task2);

        //3. join - ì²˜ë¦¬í•œ ê²°ê³¼ë¥¼ í•©ì¹¨, get - ê²°ê³¼ê°€ ë‚˜ì˜¬ ë–„ê¹Œì§€ ëŒ€ê¸°
        Integer result1 = future1.get();
        Integer result2 = future2.get();

        int sum = result1 + result2;
        long endTime = System.currentTimeMillis();
        log("time: " + (endTime - startTime) + "ms, sum: " + sum);
        es.shutdown(); // ìë°” 19+ë¶€í„° es.close()ê°€ ê°€ëŠ¥í•˜ë‹¤ê³  í•œë‹¤..
```

1. Executors.newFixedThreadPool(2)ëŠ”
ìµœëŒ€ 2ê°œì˜ ìŠ¤ë ˆë“œë¥¼ ì œê³µí•˜ëŠ” ìŠ¤ë ˆë“œ í’€ì„ ë§Œë“ ë‹¤.

```java
    static class SumTask implements Callable<Integer> {
        int startValue;
        int endValue;

        public SumTask(int startValue, int endValue) {
            this.startValue = startValue;
            this.endValue = endValue;
        }

        @Override
        public Integer call() {
            log("ì‘ì—… ì‹œì‘");
            int sum = 0;
            for (int i = startValue; i <= endValue; i++) {
                int calculated = HeavyJob.heavyTask(i);
                sum += calculated;
            }
            log("ì‘ì—… ì™„ë£Œ result: " + sum);
            return sum;
        }
    }
```
2. `SumTask` ë©”ì„œë“œë¥¼ ì´ìš©í•´ì„œ ì‘ì—…ì„ ë‘ê°œë¡œ ë¶„í• í•œë‹¤.
3. ìŠ¤ë ˆë“œí’€ì˜ `submit`ë©”ì„œë“œë¥¼ í†µí•´ ìŠ¤ë ˆë“œ í’€ ì ì—…ì„ ë§¡ê²¨ Future ê°ì²´ë¥¼ ë°›ê³ 
4. ì‹¤ì œ ê²°ê³¼ê°€ ë‚˜ì˜¬ë•Œê¹Œì§€ ëŒ€ê¸°í•œë‹¤.

ì—¬ëŸ¬ ìŠ¤ë ˆë“œë¥¼ í†µí•´ ì‹¤í–‰ì‹œê°„ì´ ë” ë‹¨ì¶•ë˜ê³  `Future`ë¡œ ë°˜í™˜ê°’ì„ ì‰½ê²Œ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤.
í•˜ì§€ë§Œ ë¶„í• /ë³‘í•© ë¡œì§ì„ ì§ì ‘ ì§œì•¼í•˜ëŠ” ë‹¨ì ì´ ìˆë‹¤

---

## Fork/join íŒ¨í„´

ì§€ê¸ˆê¹Œì§€ëŠ” ê°œë°œìê°€ ì‘ì—…ì„ ì§ì ‘ ë¶„í• í•˜ê³  ì²˜ë¦¬í•˜ê³  ì²˜ë¦¬ëœ ê²°ê³¼ë¥¼ í•©ì³¤ë‹¤
í•˜ì§€ë§Œ ìë°”ì—ì„œ Fork/Join í”„ë ˆì„ì›Œí¬ë¥¼ í†µí•´ ìœ„ íŒ¨í„´ì„ ë” ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

```java
public class ForkJoinMain1 {
    public static void main(String[] args) {
        List<Integer> data = IntStream.rangeClosed(1, 8)
                .boxed()
                .toList();
        log("[ìƒì„±]" + data);

        //forkJoinPool ìƒì„± ë° ì‘ì—… ìˆ˜í–‰
        long startTime = System.currentTimeMillis();
        ForkJoinPool pool = new ForkJoinPool(10);
        SumTask task = new SumTask(data); //1-8

        //ë³‘ë ¬ë¡œ í•©ì„ êµ¬í•œ í›„ ê²°ê³¼ ì¶œë ¥
        Integer result = pool.invoke(task);
        pool.shutdown();
        long endTime = System.currentTimeMillis();
        log("time: " + (endTime - startTime) + "ms, sum: " + result);
        log("pool: " + pool);
    }
}
```
ForkJoinPoolì„ ìƒì„±í•´ì„œ ìµœëŒ€ 10ì˜ ìŠ¤ë ˆë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìŠ¤ë ˆë“œ í’€ì„ ìƒì„±í•œë‹¤.
pool.invoke(task)ë¥¼ í†µí•´ SumTaskë¥¼ ìŠ¤ë ˆë“œ í’€ì— ì „ë‹¬í•´ì„œ ë³‘ë ¬ ì‹¤í–‰ì„ ì‹œì‘í•œë‹¤.

```java
    @Override
    protected Integer compute() {
        //ì‘ì—… ë²”ìœ„ê°€ ì‘ìœ¼ë©´ ì§ì ‘ í™•ì‚°
        if (list.size() <= THRESHOLD) {
            log("[ì²˜ë¦¬ ì‹œì‘]" + list);
            int sum = list.stream()
                    .mapToInt(Integer::intValue)
                    .sum();
            log("[ì²˜ë¦¬ ì™„ë£Œ]" + list + "-> sum: " + sum);
            return sum;
        } else {
            //ì‘ì—… ë²”ìœ„ê°€ í¬ë©´ ë°˜ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ë³‘ë ¬ ì²˜ë¦¬
            int mid = list.size() / 2;
            List<Integer> leftList = list.subList(0, mid);
            List<Integer> rightLIst = list.subList(mid, list.size());
            log("[ë¶„í• ]" + list + "-> LEFT: " + leftList + ", RIGHT: " + rightLIst);

            SumTask leftTask = new SumTask(leftList);
            SumTask rightTask = new SumTask(rightLIst);

            //ì™¼ìª½ ì‘ì—…ì€ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì²˜ë¦¬
            leftTask.fork();
            // ì˜¤ë¥¸ìª½ ì‘ì—…ì€ í˜„ì œ ìŠ¤ë ˆë“œì—ì„œ ì²˜ë¦¬
            int rightResult = rightTask.compute();

            //ì™¼ìª½ ì‘ì—… ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¼
            int leftResult = leftTask.join();
            //ì™¼ìª½ê³¼ ì˜¤ë¥¸ìª½ ì‘ì—… ê²°ê³¼ í•©ì¹¨
            int joinSum = leftResult + rightResult;
            log("LEFT[" + leftResult + "] RIGHT[" + rightResult + "] joinSum: " + joinSum);
            return joinSum;
        }
    }
```
ì¦‰, SumTask í´ë˜ìŠ¤ì—ì„œ compute() ë‚´ë¶€ì—ì„œ ì‘ì—…ì˜ ë¡œì§ì„ ì •ì˜í•˜ê³ ,
ForkJoinMain1 í´ë˜ìŠ¤ ë‚´ë¶€ì—ì„œ invoke()ë¥¼ í†µí•´ ì‹¤ì œ ì‘ì—… ì‹¤í–‰ ê³¼ì •ìœ¼ë¡œ ì§„í–‰ëœë‹¤.
